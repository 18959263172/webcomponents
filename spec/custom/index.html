<!DOCTYPE html>
<html lang="en">
<head>
<title>Custom Elements</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link rel="stylesheet" href="../../assets/styles/spec.css" type="text/css">
<link rel="stylesheet" href="../../assets/styles/prettify.css" type="text/css">
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/W3C-ED" type="text/css" >
<script src="../../assets/scripts/bug-assist.js"></script>
<script src="../../assets/scripts/spec-assist.js"></script>
<script src="../../assets/scripts/prettify.js"></script>
<meta name="bug.blocked" content="14968">
<meta name="bug.short_desc" content="[Custom]: ">
<meta name="bug.product" content="WebAppsWG">
<meta name="bug.component" content="Component Model">
</head>

<body>

<div class="head">

<div class="logo">
    <a href="//www.w3.org/"><img width="72" height="48" src="http://www.w3.org/Icons/w3c_home" alt="W3C"></a>
</div>

<h1>Custom Elements</h1>
<h2 id="editors-draft">W3C Editor's Draft</h2>
<dl>
<dt>This version</dt>
    <dd><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/custom/index.html">https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/custom/index.html</a></dd>
<dt>Latest editor's draft</dt>
    <dd><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/custom/index.html">https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/custom/index.html</a></dd>
<dt>Previous version</dt>
    <dd><a href="http://www.w3.org/TR/custom-elements/">http://www.w3.org/TR/custom-elements/</a></dd>
<dt>Revision history</dt>
    <dd><a id="log" href="https://dvcs.w3.org/hg/webcomponents/log/tip/spec/custom/index.html">https://dvcs.w3.org/hg/webcomponents/log/tip/spec/custom/index.html</a></dd>
<dt>Participate</dt>
    <dd>Discuss on <a href="http://lists.w3.org/Archives/Public/public-webapps/">public-webapps@w3.org</a> (<a href="http://www.w3.org/2008/webapps/">Web Applications Working Group</a>)</dd>
    <dd><a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?comment=&amp;blocked=14968&amp;short_desc=%5BCustom%5D%3A%20&amp;product=WebAppsWG&amp;component=Component%20Model">File bugs</a> (w3.org's <a href="https://www.w3.org/Bugs/Public/">Bugzilla</a>)</dd>
<dt>Editor</dt>
    <dd class="vcard"><span class="fn">Dimitri Glazkov</span>, <span class="org">Google</span>, &lt;<a class="email" href="mailto:dglazkov@chromium.org">dglazkov@chromium.org</a>&gt;</dd>
</dl>

<p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> &copy; 2012 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>&copy;</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p>

<hr>

<h2 id="abstract">Abstract</h2>

<p>This specification describes the method for enabling the author to define and use new types of DOM elements in a document.</p>

<h2 id="status">Status of This Document</h2>

<p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at http://www.w3.org/TR/.</em></p>

<p>This document was published by the <a href="http://www.w3.org/2008/webapps/">Web Applications Working Group</a> as an Editor's Draft. If you wish to make comments regarding this document, please send them to <a href="mailto:public-webapps@w3.org">public-webapps@w3.org</a> (<a href="mailto:public-webapps-request@w3.org?subject=subscribe">subscribe</a>, <a href="http://lists.w3.org/Archives/Public/public-webapps/">archives</a>). All feedback is welcome.</p><p>Publication as an Editor's Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.</p>

<p>This document was produced by a group operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="http://www.w3.org/2004/01/pp-impl/45559/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.</p>

</div>

<section class="toc">
<h2 id="toc">Table of Contents</h2>
<ol>
    <li><a href="#about">About this Document</a></li>
    <li><a href="#dependencies">Dependencies</a></li>
    <li><a href="#terminology">Terminology</a></li>
    <li><a href="#custom-element-lifecycle">Custom Element Lifecycle</a></li>
    <li><a href="#registering-custom-elements">Registering Custom Elements</a>
    <ol>
        <li><a href="#unresolved-element-pseudoclass">Unresolved Element Pseudoclass</a></li>
    </ol></li>
    <li><a href="#instantiating-custom-elements">Instantiating Custom Elements</a></li>
    <li><a href="#serializing-and-parsing">Serializing and Parsing Custom Elements in HTML</a></li>
    <li><a href="#declaring-custom-elements">Declaring Custom Elements</a>
    <ol>
        <li><a href="#the-element-element">The <code>element</code> HTML element</a></li>
    </ol></li>
<!--
    <li><a href="#elements-and-dom-interfaces"><span class="section">10</span> Elements and DOM Interfaces</a>
    <li><a href="#other-languages"><span class="section">11</span> Other Languages</a></li> -->
    <li><a href="#acknowledgements" class="no-number">Acknowledgements</a></li>
</ol>

</section>

<section class="spec">

<h2 id="about">About this Document</h2>

<p>All diagrams, examples, notes, are non-normative, as well as sections explicitly marked as non-normative. Everything else in this specification is normative.</p>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this document are to be interpreted as described in <a href="http://dev.w3.org/2006/xbl2/#refsRFC2119">RFC2119</a>. For readability, these words do not appear in all uppercase letters in this specification.</p>

<p>Any point, at which a conforming UA must make decisions about the state or reaction to the state of the conceptual model, is captured as <a href="http://en.wikipedia.org/wiki/Algorithm">algorithm</a>. The algorithms are defined in terms of processing equivalence. The <dfn id="dfn-processing-equivalence">processing equivalence</dfn> is a constraint imposed on the algorithm implementors, requiring the output of the both UA-implemented and the specified algorithm to be exactly the same for all inputs.</p>

<h2 id="dependencies">Dependencies</h2>

<p>This document relies on the following specifications:</p>

<ul>
    <li><a href="http://www.w3.org/TR/CSS2/">CSS Level 2 Revision 1</a></li>
    <li><a href="http://dev.w3.org/csswg/cssom/">CSSOM</a></li>
    <li><a href="http://www.w3.org/TR/DOM-Level-3-Events/">DOM Level 3 Events</a></li>
    <li><a href="http://www.w3.org/TR/domcore/">DOM4 (DOM Core)</a></li>
    <li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/">HTML</a></li>
    <li><a href="http://html5.org/specs/dom-parsing.html">DOM Parsing and Serialization</a></li>
    <li><a href="http://ecma-international.org/ecma-262/5.1/">ECMAScript Language Specification</a></li>
    <li><a href="http://www.w3.org/TR/selectors/">Selectors Level 3</a></li>
    <li><a href="http://dev.w3.org/2006/webapi/selectors-api/">Selectors API Level 1</a></li>
    <li><a href="http://www.w3.org/TR/WebIDL/">Web IDL</a></li>
</ul>

</section>

<section class="physics">

<h2 id="terminology">Terminology</h2>

<p><dfn id="dfn-custom-element">Custom element</dfn> is <a href="http://www.w3.org/TR/WebIDL/#dfn-platform-object">platform object</a> whose <a href="http://www.w3.org/TR/WebIDL/#dfn-interface">interface</a> is defined by the author. This <a href="http://www.w3.org/TR/WebIDL/#dfn-interface">interface</a> <strong>must</strong> <a href="http://www.w3.org/TR/WebIDL/#dfn-inherit">inherit</a> from the <a href="http://dom.spec.whatwg.org/#interface-element"><code>Element</code></a> <a href="http://www.w3.org/TR/WebIDL/#dfn-interface">interface</a>. The <a href="http://www.w3.org/TR/WebIDL/#interface-prototype-object">interface prototype object</a> of a <a href="#dfn-custom-element">custom element</a>'s <a href="http://www.w3.org/TR/WebIDL/#dfn-interface">interface</a> is called the <dfn id="dfn-custom-element-prototype">custom element prototype</dfn>.</p>

<p>The <dfn id="dfn-custom-element-type">custom element type</dfn> identifies a <a href="#dfn-custom-element">custom element</a> <a href="http://www.w3.org/TR/WebIDL/#dfn-interface">interface</a> and is a sequence of <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/common-microsyntaxes.html#alphanumeric-ascii-characters">alphanumeric ASCII characters</a> that <strong>must</strong> match the <a href="http://www.w3.org/TR/1999/REC-xml-names-19990114/#NT-NCName">NCName</a> production and contain a <var>U+002D HYPHEN-MINUS</var> character. The <a href="#dfn-custom-element-type">custom element type</a> <strong>must not</strong> be one of the following values:</p>
<ul>
    <li><code>annotation-xml</code></li>
    <li><code>color-profile</code></li>
    <li><code>font-face</code></li>
    <li><code>font-face-src</code></li>
    <li><code>font-face-uri</code></li>
    <li><code>font-face-format</code></li>
    <li><codE>font-face-name</code></li>
    <li><code>missing-glyph</code></li>
</ul>

<div class="informative">
The list of names above is the summary of all hyphen-containing element names from the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#other-applicable-specifications">applicable specifications</a>, namely the <a href="http://www.w3.org/TR/SVG/eltindex.html">SVG</a> and the <a href="http://www.w3.org/TR/MathML/">MathML</a>.
</div>

<p>The <dfn id="dfn-element-definition">element definition</dfn> completely describes the type of a <a href="#dfn-custom-element">custom element</a> and consists of:</p>
<ul>
    <li>a <a href="#dfn-custom-element-type">custom element type</a>,</li>
    <li>a <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a>,</li>
    <li>a <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a>,</li>
    <li>a <a href="#dfn-custom-element-prototype">custom element prototype</a>, and </li>
    <li><a href="#dfn-lifecycle-callbacks">lifecycle callbacks</a>.</li>
</ul>

<p>Whenever created, each <a href="http://dom.spec.whatwg.org/#concept-document">document</a> <strong>must</strong> retain a <a href="http://en.wikipedia.org/wiki/Weak_reference">weak reference</a> to the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#window"><code>Window</code></a> object of the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#browsing-context">browsing context</a>'s <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#active-document">active document</a>. This referenced <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#window"><code>Window</code></a> object is called the <dfn id="dfn-registration-context">registration context</dfn>.</p>

<p><dfn id="dfn-element-registration">Element registration</dfn> is a process of associating an <a href="#dfn-element-definition">element definition</a> with a <a href="#dfn-registration-context">registration context</a>. An <a href="#dfn-element-definition">element definition</a> can only be <a href="#dfn-element-registration">registered</a> with one <a href="#dfn-registration-context">registration context</a>. Once <a href="#dfn-element-registration">registered</a>, the <a href="#dfn-custom-element">custom element</a>'s <a href="http://www.w3.org/TR/WebIDL/#dfn-interface">interface</a> <strong>must</strong> be the <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> for <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> and <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a> values of <a href="#dfn-custom-element-type">custom element type</a> and the <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a> in <a href="#dfn-element-definition">custom element definition</a>, respectively.</p>

<div class="informative">
Conceptually, all these associations of custom elements with a registration context form a <em>registry</em>, which is consulted whenever a new DOM element is created, whether imperatively or by the parser. Whenever a matching element definition is found in the registry, the information in this definition is used to create a new instance of a custom element.</p>
<p>Whenever the <code>Window</code> object (aka the registration context) goes away, so does its registry, thus preventing further creation of custom elements on a document without a <code>Window</code> (for instance, the documents of an iframe that was navigated away).</p>
</div>

<h2 id="custom-element-lifecycle">Custom Element Lifecycle</h2>

<p>A <a href="#dfn-custom-element">custom element</a> can go through these changes during its lifetime:</p>
<ol>
    <li><a href="#dfn-custom-element">Custom element</a> is created before its <a href="#dfn-custom-element">custom element definition</a> is <a href="#dfn-element-registration">registered</a></li>
    <li><a href="#dfn-element-definition">Definition</a> of a <a href="#dfn-custom-element">custom element</a> is <a href="#dfn-element-registration">registered</a></li>
    <li><a href="#dfn-custom-element">Custom element</a> instance is created after its <a href="#dfn-element-definition">definition</a> was <a href="#dfn-element-registration">registered</a></li>
    <li><a href="#dfn-custom-element">Custom element</a> is <a href="http://www.whatwg.org/specs/web-apps/current-work/#insert-an-element-into-a-document">inserted into a document</a></li>
    <li><a href="#dfn-custom-element">Custom element</a> is <a href="http://www.whatwg.org/specs/web-apps/current-work/#remove-an-element-from-a-document">removed from the document</a></li>
    <li>A <a href="#dfn-custom-element">Custom element</a>'s <a href="http://dom.spec.whatwg.org/#concept-attribute">attribute</a> is created, removed, or modified</li>
    <li><a href="#dfn-custom-element">Custom element</a> is garbage-collected.</li>
</ol>

<p>A <a href="#dfn-custom-element">custom element</a> can optionally implement several callbacks that are invoked when the element goes through some of these changes. These callbacks are stored internally as a collection of <a href="http://en.wikipedia.org/wiki/Associative_array">key-value pairs</a> and called <dfn id="dfn-lifecycle-callbacks">lifecycle callbacks</dfn>.</p>

<p>To <dfn id="dfn-transfer-callback">transfer a callback named <em>name</em> from an object property named <em>property</em></dfn> to <a href="#dfn-lifecycle-callbacks">lifecycle callbacks</a>, the user agent <strong>must</strong> run the following steps:</p>
<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>NAME</var>, name of the callback</dd>
    <dd><var>PROPERTY</var>, name of the property</dd>
    <dd><var>OBJECT</var>, the object from which <var>PROPERTY</var> is being transferred</dd>
    <dd><var>LIFECYCLE</var>, the <a href="#dfn-lifecycle-callbacks">lifecycle callbacks</a></dd>
<dt>Output</d>
    <dd>None</dd>
</dl>
<ol>
    <li>Let <var>CALLBACK</var> be the result of <a href="http://es5.github.io/#x8.12.3">getting</a> a property named <var>PROPERTY</var> of <var>OBJECT</var></li>
    <li>If <var>CALLBACK</var> exists and is a <a href="http://es5.github.io/#callable">callable object</a>, add <var>CALLBACK</var> to <var>LIFECYCLE</var>, associated with the key <var>NAME</var>.</li>
</ol>
</div>

<p>To <dfn id="dfn-retrieve-callback">retrieve a callback named <em>name</em></dfn> for an <a href="http://dom.spec.whatwg.org/#concept-element">element</a>, the user agent <strong>must</strong> run the following steps:</p>
<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>NAME</var>, name of the callback</dd>
    <dd><var>ELEMENT</var>, the <a href="http://dom.spec.whatwg.org/#concept-element">element</a></dd>
<dt>Output</dt>
    <dd><var>CALLBACK</var>, the callback</dd>
</dl>
<ol>
    <li>Let <var>DEFINITION</var> be <var>ELEMENT</var>'s <a href="#dfn-element-definition">definition</a></li>
    <li>If <var>DEFINITION</var> does not exist, let <var>CALLBACK</var> be <strong>null</strong> and <strong>stop</strong>.</li>
    <li>Let <var>CALLBACKS</var> be the <a href="#dfn-lifecycle-callbacks">lifecycle callbacks</a> from <var>DEFINITION</var>
    <li>Let <var>CALLBACK</var> be the callback, associated with the key <var>NAME</var> in <var>CALLBACKS</var>, or <strong>null</strong> if there is no such callback.</li>
</ol>
</div>

<p>Each <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a> has an associated <dfn id="dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</dfn>, which is initially empty. Each item in the queue consists of the callback itself, the <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback this value</a>, which is an <a href="http://dom.spec.whatwg.org/#concept-element">element</a>, and zero or more string values that are used as callback arguments.</p>

<p>Also, each <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin contexts</a> has a <dfn id="dfn-running-lifecycle-callbacks">running lifecycle callbacks</dfn> flag, which <strong>must</strong> initially be <strong>false</strong>. It is used to prevent reentrant invocation of the algorithm to <a href="#dfn-invoke-lifecycle-callbacks">invoke lifecycle callbacks</a>.</p>

<p>To <dfn id="dfn-invoke-lifecycle-callbacks">invoke lifecycle callbacks</dfn>, a conforming user agent <strong>must</strong> run the following steps or their <a href="#dfn-processing-equivalence">equivalent</a>:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>ENVIRONMENT</var>, the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a></dd>
<dt>Output</dt>
    <dd>None</dd>
</dl>
<ol>
    <li>Let <var>RUNNING</var> be the <a href="#dfn-running-lifecycle-callbacks">running lifecycle callbacks</a> flag</li>
    <li>If <var>RUNNING</var> is <strong>true</strong>, <strong>stop</strong>.</li>
    <li>Set <var>RUNNING</var> to <strong>true</strong>.</li>
    <li>Let <var>INVOCATIONS</var> be a copy of the <var>ENVIRONMENT</var>'s <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a></li>
    <li>While <var>INVOCATIONS</var> is not empty:
    <ol>
        <li>Empty <var>ENVIRONMENT</var>'s <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a>.
        <li>For each <var>INVOCATION</var> in <var>INVOCATIONS</var>:
        <ol>
            <li>Invoke callback in <var>INVOCATION</var> with the corresponding <a href="http://dev.w3.org/2006/webapi/WebIDL/#dfn-callback-this-value">callback this value</a> and, if present, use string values supplied in <var>INVOCATION</var> as arguments</li>
        </ol></li>
        <li>Let <var>INVOCATIONS</var> be a copy of the <var>ENVIRONMENT</var>'s <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a></li>
    </ol></li>
    <li>Set <var>RUNNING</var> to <strong>false</strong>.</li>
</ol>
</div>

<p><a href="http://dom.spec.whatwg.org/#concept-element">Elements</a> have a <a href="http://en.wikipedia.org/wiki/Strong_reference">strong reference</a> to their <a href="#dfn-lifecycle-callbacks">lifecycle callbacks</a> in the <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a>, and <a href="#dfn-lifecycle-callbacks">lifecycle callbacks</a> in the <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a> have a <a href="http://en.wikipedia.org/wiki/Weak_reference">weak reference</a> to their <a href="http://dom.spec.whatwg.org/#concept-element">elements</a>.</p>

<p>The following callbacks are recognized:</p>
<dl>
<dt id="dfn-created-callback">created</dt>
    <dd>This callback is invoked after <a href="#dfn-custom-element">custom element</a> instance is created and its <a href="#dfn-element-definition">definition</a> is associated with the <a href="#dfn-registration-context">registration context</a>. The actual timing of this callback is defined further in this specification.</dd>
    <dd>The <a href="#dfn-custom-element-prototype">custom element prototype</a> <strong>must</strong> be <a href="#dfn-set-prototype">set</a> just prior to invoking callback.</dd>
<dt>inserted</dt>
    <dd>Unless specified otherwise, this callback <strong>must</strong> be placed into the <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a> with the <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback this value</a> of the <a href="#dfn-custom-element">custom element</a> whenever <a href="#dfn-custom-element">custom element</a> is <a href="http://www.whatwg.org/specs/web-apps/current-work/#insert-an-element-into-a-document">inserted into a document</a>.</dd>
<dt>removed</dt>
    <dd>Unless specified otherwise, this callback <strong>must</strong> be placed into the <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a> with the <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback this value</a> of the <a href="#dfn-custom-element">custom element</a> whenever <a href="#dfn-custom-element">custom element</a> is <a href="http://www.whatwg.org/specs/web-apps/current-work/#remove-an-element-from-a-document">removed from the document.</a>
<dt>attributeChanged</dt>
    <dd>With one <a href="#dfn-attribute-changed-exception">exception</a>, this callback <strong>must</strong> be placed into the <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a> with the <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback this value</a> of the <a href="#dfn-custom-element">custom element</a> whenever <a href="#dfn-custom-element">custom element</a>'s <a href="http://dom.spec.whatwg.org/#concept-attribute">attribute</a> is <a href="http://dom.spec.whatwg.org/#attribute-is-added">added</a>, <a href="http://dom.spec.whatwg.org/#attribute-is-changed">changed</a> or <a href="http://dom.spec.whatwg.org/#attribute-is-removed">removed</a>. Depending on the type of <a href="http://dom.spec.whatwg.org/#concept-attribute">attribute</a> modification, the following additional strings are added to the queue item:
    <dl>
    <dt><a href="http://dom.spec.whatwg.org/#attribute-is-added">attribute is set</a></dt>
        <dd><a href="http://dom.spec.whatwg.org/#concept-attribute-name">attribute name</a>, <strong>null</strong> and new <a href="http://dom.spec.whatwg.org/#concept-attribute-value">attribute value</a></dd>
    <dt><a href="http://dom.spec.whatwg.org/#attribute-is-changed">attribute is changed</a></dt>
        <dd><a href="http://dom.spec.whatwg.org/#concept-attribute-name">attribute name</a>, old <a href="http://dom.spec.whatwg.org/#concept-attribute-value">attribute value</a> and new <a href="http://dom.spec.whatwg.org/#concept-attribute-value">attribute value</a></dd>
    <dt><a href="http://dom.spec.whatwg.org/#attribute-is-removed">attribute is removed</a>
        <dd><a href="http://dom.spec.whatwg.org/#concept-attribute-name">attribute name</a>, old <a href="http://dom.spec.whatwg.org/#concept-attribute-value">attribute value</a> and <strong>null</strong></dd>
    </dl>
    <dfn id="#dfn-attribute-changed-exception">attribute change via DOM API exception</dfn>: when the <a href="http://dom.spec.whatwg.org/#concept-attribute">attribute</a> is modified with <a href="http://dom.spec.whatwg.org/#dom-element-setattribute"><code>setAttribute</code></a>, <a href="http://dom.spec.whatwg.org/#dom-element-setattributens"><code>setAttributeNS</code></a>, <a href="http://dom.spec.whatwg.org/#dom-element-removeattribute"><code>removeAttribute</code></a>, or <a href="http://dom.spec.whatwg.org/#dom-element-removeattributens"><code>removeAttributeNS</code></a> methods of the <a href="#dfn-custom-element">custom element</a>, as well as setting the <a href="http://dom.spec.whatwg.org/#dom-attr-value"><code>value</code></a> property of the <a href="#dfn-custom-element">custom element</a>'s <a href="http://dom.spec.whatwg.org/#concept-attribute">attribute</a>, the callback <strong>must</strong> be invoked immediately.</dd> 
</dl>

<p>To <dfn id="dfn-set-prototype">set custom element prototype</dfn> on a <a href="#dfn-custom-element">custom element</a>, a conforming user agent <strong>must</strong> run the following steps or their <a href="#dfn-processing-equivalence">equivalent</a>:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>ELEMENT</var>, <a href="#dfn-custom-element">element</a></dd>
<dt>Output</dt>
    <dd>None</dd>
</dl>
<ol>
    <li>Let <var>PROTOTYPE</var> be the <a href="#dfn-custom-element-prototype">custom element prototype</a> in <var>ELEMENT</var>'s <a href="#dfn-element-definition">definition</a></li>
    <li>Set the value of the <code>[[Prototype]]</code> <a href="http://es5.github.com/#x8.6.2">internal property</a> of <var>ELEMENT</var> to <var>PROTOTYPE</var></li>
</ol>
</div>


<h2 id="registering-custom-elements">Registering Custom Elements</h2>

<p>Because <a href="#dfn-element-registration">element registration</a> can occur at any time, a <a href="#dfn-custom-element">custom element</a> could be created before its <a href="#dfn-element-definition">definition</a> is <a href="#dfn-element-registration">registered</a>. Such <a href="#dfn-custom-element">custom element</a> instances are called <dfn id="dfn-unresolved-element">unresolved elements</dfn>. When an <a href="#dfn-unresolved-element">unresolved element</a> is created, <strong>and</strong> if its  <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> was not defined by <a href="http://www.whatwg.org/specs/web-apps/current-work/">HTML</a> or <a href="http://www.whatwg.org/specs/web-apps/current-work/#other-applicable-specifications">other applicable specifications</a>, the <a href="#dfn-unresolved-element">unresolved element</a>'s <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> <strong>must</strong> be:</p>
<ul>
    <li>the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#htmlelement"><code>HTMLElement</code></a>, if the <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a> is <a href="http://www.w3.org/1999/xhtml">HTML Namespace</a>;</li>
    <li>the <a href="http://www.w3.org/TR/SVG/types.html#InterfaceSVGElement"><code>SVGElement</code></a>, if <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a> is <a href="http://www.w3.org/2000/svg">SVG Namespace</a>; or</li>
    <li>unknown, otherwise.</li>
</ul>

<div class="informative">
The effect of this statement is that any HTML (or SVG) element with the local name that is a valid custom element type will have HTMLElement (or SVGElement) as element interface, rather than HTMLUnknownElement.
</div>

<p>Each <a href="#dfn-registration-context">registration context</a> has an associated <a href="http://en.wikipedia.org/wiki/Associative_array">map</a> of all instances of <a href="#dfn-unresolved-element">unresolved elements</a> for a given pair of <a href="#dfn-custom-element-type">custom element type</a> and <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a>. This data structure is called the <dfn id="dfn-upgrade-candidates-map">upgrade candidates map</dfn> and is initially empty.</p>

<p>Whenever an <a href="#dfn-unresolved-element">unresolved element</a> is created, it <strong>must</strong> be added at the front of the <A href="#dfn-upgrade-candidates-map">upgrade candidates map</a>.</p>

<p>An <a href="#dfn-element-definition">element definition</a> is created and associated with a <a href="#dfn-registration-context">registration context</a> by the <dfn id="dfn-element-registration-algorithm">element registration algorithm</dfn>, which <strong>must</strong> be <a href="#dfn-processing-equivalence">equivalent</a> to running these steps:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>DOCUMENT</var>, the <a href="http://dom.spec.whatwg.org/#concept-document">document</a></dd>
    <dd><var>TYPE</var>, the <a href="#dfn-custom-element-type">custom element type</a> of the element being registered</dd>
    <dd><var>PROTOTYPE</var>, the <a href="#dfn-custom-element-prototype">custom element prototype</a></dd>
    <dd><var>NAME</var>, a <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a>, optional</dd>
<dt>Output</dt>
    <dd><var>ERROR</var>, a variable that holds one of these values: <code>None</code>, <code>InvalidType</code>, <code>InvalidName</code>, <code>InvalidContext</code>, or <code>DuplicateDefinition</code></dd>
</dl>
<ol>
    <li>Let <var>ERROR</var> and <var>DEFINITION</var> be the result of running <a href="#dfn-definition-construction-algorithm">definition construction algorithm</a> with <var>DOCUMENT</var>, <var>TYPE</var>, <var>PROTOTYPE</var>, and <var>NAME</var> as arguments</li>
    <li>If <var>ERROR</var> is not <code>None</code>, <strong>stop</strong>.</li>
    <li>Let <var>CONTEXT</var> be <var>DOCUMENT</var>'s <a href="#dfn-registration-context">registration context</a></li>
    <li>If <var>CONTEXT</var> does not exist, set <var>ERROR</var> to <code>InvalidContext</code> and <strong>stop</strong>.</li>
    <li>Associate <var>DEFINITION</var> with <var>CONTEXT</var></li>
    <li>Run <a href="#dfn-element-upgrade-algorithm">element upgrade algorithm</a> with <var>CONTEXT</var> and <var>DEFINITION</var> as arguments.</li>
</ol>
</div>

<p>The <dfn id="dfn-definition-construction-algorithm">definition construction algorithm</dfn> creates an <a href="#dfn-element-definition">element definition</a> and <strong>must</strong> be <a href="#dfn-processing-equivalence">equivalent</a> to running these steps:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>DOCUMENT</var>, the <a href="http://dom.spec.whatwg.org/#concept-document">document</a></dd>
    <dd><var>TYPE</var>, the <a href="#dfn-custom-element-type">custom element type</a> of the element being registered</dd>
    <dd><var>PROTOTYPE</var>, the <a href="#dfn-custom-element-prototype">custom element prototype</a></dd>
    <dd><var>NAME</var>, a <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a>, optional</dd>
<dt>Output</dt>
    <dd><var>DEFINITION</var>, the <a href="#dfn-element-definition">element definition</a></dd>
    <dd><var>ERROR</var>, a variable that holds one of these values: <code>None</code>, <code>InvalidType</code>, <code>InvalidName</code>, or <code>DuplicateDefinition</code></dd>
</dl>
<ol>
    <li>Let <var>ERROR</var> be <code>None</code></li>
    <li>If <var>DOCUMENT</var> is an <a href="http://dom.spec.whatwg.org/#html-document">HTML document</a>, <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#converted-to-ascii-lowercase">convert</a> <var>TYPE</var> and <var>NAME</var> to lowercase</li>
    <li>If <var>TYPE</var> is an invalid <a href="#dfn-custom-element-type">custom element type</a>, set <var>ERROR</var> to <code>InvalidType</code> and <strong>stop</strong>.</li>
    <li>Let <var>NAMESPACE</var> be <a href="http://www.w3.org/1999/xhtml">HTML Namespace</a></li>
    <li>If <var>PROTOTYPE</var>'s <a href="http://www.w3.org/TR/WebIDL/#dfn-interface">interface</a> <a href="http://www.w3.org/TR/WebIDL/#dfn-inherit">inherits</a> from <a href="http://www.w3.org/TR/SVG/types.html#InterfaceSVGElement"><code>SVGElement</code></a>, set <var>NAMESPACE</var> to <a href="http://www.w3.org/2000/svg">SVG Namespace</a></li>
    <li>If there already exists a <a href="#dfn-element-definition">definition</a> with the same <var>TYPE</var> and <var>NAMESPACE</var>, set <var>ERROR</var> to <code>DuplicateDefinition</code> and <strong>stop</strong>.</li>
    <li>If <var>NAME</var> was provided or is not <strong>null</strong>:
    <ol>
        <li>Let <var>BASE</var> be the <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> for <var>NAME</var> and <var>NAMESPACE</var></li>
        <li>If <var>BASE</var> does not exist, set <var>ERROR</var> to <code>InvalidName</code> and <strong>stop</strong>.</li>
        <li>If <var>BASE</var> is an <a href="http://www.w3.org/TR/WebIDL/#dfn-interface">interface</a> for a <a href="#dfn-custom-element">custom element</a>, let <var>NAME</var> be the <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> in that element's <a href="#dfn-element-definition">definition</a></li>
    </ol></li>
    <li>Otherwise:
    <ol>
        <li>If <var>NAMESPACE</var> is <a href="http://www.w3.org/2000/svg">SVG Namespace</a>,  set <var>ERROR</var> to <code>InvalidName</code> and <strong>stop</strong>.</li>
        <li>Let <var>NAME</var> be <var>TYPE</var></li>
    </ol></li>
    <li>Let <var>LIFECYCLE</var> be <a href="#dfn-lifecycle-callbacks">lifecycle callbacks</a></li>
    <li><a href="#dfn-transfer-callback">Transfer callback</a> named <em>created</em> to <var>LIFECYCLE</var> from property named <em>createdCallback</em> on <var>PROTOTYPE</var></li>
    <li><a href="#dfn-transfer-callback">Transfer callback</a> named <em>inserted</em> to <var>LIFECYCLE</var> from property named <em>insertedCallback</em> on <var>PROTOTYPE</var></li>
    <li><a href="#dfn-transfer-callback">Transfer callback</a> named <em>removed</em> to <var>LIFECYCLE</var> from property named <em>removedCallback</em> on <var>PROTOTYPE</var></li>
    <li><a href="#dfn-transfer-callback">Transfer callback</a> named <em>attributeChanged</em> to <var>LIFECYCLE</var> from property named <em>attributeChangedCallback</em> on <var>PROTOTYPE</var></li>
    <li>Let <var>DEFINITION</var> be an <a href="#dfn-element-definition">element definition</a> with <a href="#dfn-custom-element-type">custom element type</a> set to <var>TYPE</var>, <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> to <var>NAME</var>, <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a> to <var>NAMESPACE</var>, <a href="#dfn-custom-element-prototype">custom element prototype</a> to <var>PROTOTYPE</var>, and <a href="#dfn-lifecycle-callbacks">lifecycle callbacks</a> to <var>LIFECYCLE</var>.</li>
</ol>
</div>

<p>The <dfn id="dfn-element-upgrade-algorithm">element upgrade algorithm</dfn> upgrades <a href="#dfn-unresolved-element">unresolved elements</a> whose definition is now <a href="#dfn-element-registration">registered</a> and <strong>must</strong> be <a href="#dfn-processing-equivalence">equivalent</a> to running these steps:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>CONTEXT</var>, the <a href="#dfn-registration-context">registration context</a></dd>
    <dd><var>DEFINITION</var>, <a href="#dfn-element-definition">element definition</a></dd>
<dt>Output</dt>
    <dd>None</dd>
</dl>
<ol>
    <li>Let <var>TYPE</var> be the <a href="#dfn-custom-element-type">custom element type</a> in <var>DEFINITION</var></li>
    <li>Let <var>MAP</var> be <var>CONTEXT</var>'s <A href="#dfn-upgrade-candidates-map">upgrade candidates map</a></li>
    <li>Let <var>CANDIDATES</var> be the list of all <a href="#dfn-unresolved-element">unresolved elements</a> for <var>TYPE</var> and <var>NAMESPACE</var> in <var>MAP</var></li>
    <li>For each item <var>ELEMENT</var> in <var>CANDIDATES</var>:
    <ol>
        <li>Let <var>CREATED</var> be the result of <a href="#dfn-retrieve-callback">retrieving a callback</a> named <em>created</em>.</li>
        <li>Place <var>CREATED</var> and <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback this value</a> of <var>ELEMENT</var> into the <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a>.</li>
        <li>If <var>ELEMENT</var> is <a href="http://www.whatwg.org/specs/web-apps/current-work/#in-a-document">in a document</a>:
        <ol>
            <li>Let <var>INSERTED</var> be the result of <a href="#dfn-retrieve-callback">retrieving a callback</a> named <em>inserted</em>.</li>
            <li>Place <var>INSERTED</var> and <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback this value</a> of <var>ELEMENT</var> into the <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a>.</li>
        </ol></li>
    </ol></li>
    <li>Set <var>CANDIDATES</var> to empty list</li>
</ol>
</div>

<p>The <dfn id="dfn-document-register"><code>register</code></dfn> method of the <a href="http://www.w3.org/TR/domcore/#document">Document</a> interface provides a way to <a href="#dfn-element-registration">register</a> a <a href="#dfn-custom-element">custom element</a> and returns its <a href="#dfn-custom-element-constructor">custom element constructor</a>.</p>

<pre><code>
partial interface <a href="http://www.w3.org/TR/domcore/#document">Document</a> {
    Function <a href="#dfn-document-register">register</a>(DOMString <a href="#var-document-register-type">type</a>, optional <a href="#api-element-registration-options">ElementRegistrationOptions</a> options);
};

dictionary <dfn id="api-element-registration-options">ElementRegistrationOptions</dfn> {
     object? <a href="#var-options-prototype">prototype</a> = null;
     DOMString? <a href="#var-options-extends">extends</a> = null;
};

</code></pre>

<p>When called, the <a href="#dfn-document-register"><code>register</code></a> method <strong>must</strong> run these steps:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>DOCUMENT</var>, method's <a href="http://dom.spec.whatwg.org/#context-object">context object</a>, a <a href="http://dom.spec.whatwg.org/#concept-document">document</a></dd>
    <dd><var id="var-document-register-type">TYPE</var>, the <a href="#dfn-custom-element-type">custom element type</a> of the element being registered</dd>
    <dd><var id="var-options-prototype">PROTOTYPE</var>, the <a href="#dfn-custom-element-prototype">custom element prototype</a>, optional</dd>
    <dd><var id="var-options-extends">EXTENDS</var>, the <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> of an <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#html-elements">HTML</a> or <a href="http://www.w3.org/TR/SVG/eltindex.html">SVG</a> <a href="http://dom.spec.whatwg.org/#concept-element">element</a> that is being extended, optional</dd>
<dt>Output</dt>
    <dd><var>CONSTRUCTOR</var>, the <a href="#dfn-custom-element-constructor">custom element constructor</a></dd>
</dl>
<ol>
    <li>If <var>PROTOTYPE</var> is <strong>null</strong>, let <var>PROTOTYPE</var> be the result of invoking <a href="http://es5.github.com/#x15.2.3.5"><code>Object.create</code></a> with <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#htmlelement"><code>HTMLElement</code></a>'s <a href="http://www.w3.org/TR/WebIDL/#dfn-interface-prototype-object">interface prototype object</a> as only argument</li>
    <li>Let <var>NAME</var> be <var>EXTENDS</var></li>
    <li>Let <var>ERROR</var> be the result of running the <a href="#dfn-element-registration-algorithm">element registration algorithm</a> with <var>DOCUMENT</var>, <var>TYPE</var>, <var>PROTOTYPE</var>, and <var>NAME</var> as arguments</li>
    <li>If <var>ERROR</var> is <code>InvalidType</code>, <a href="http://dom.spec.whatwg.org/#concept-throw">throw</a> a <a href="http://dom.spec.whatwg.org/#syntaxerror"><code>SyntaxError</code></a> and <strong>stop</strong>.</li>
    <li>If <var>ERROR</var> is not <code>None</code>, <a href="http://dom.spec.whatwg.org/#concept-throw">throw</a> a <a href="http://dom.spec.whatwg.org/#notsupportederror"><code>NotSupportedError</code></a> and <strong>stop</strong>.</li>
    <li>Let <var>ENVIRONMENT</var> be the <var>DOCUMENT</var>'s <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a></dd>
    <li><a href="#dfn-invoke-lifecycle-callbacks">Invoke lifecycle callbacks</a> with <var>ENVIRONMENT</var> as argument</li>
    <li>Return result of running <a href="#dfn-custom-element-constructor-generation">custom element constructor generation algorithm</a> with <var>DOCUMENT</var> and <var>PROTOTYPE</var> as arguments.</li>
</ol>
</div>

<div class="informative">
<p><code>ElementRegistrationOptions</code> is an abstraction that enables using function objects and ES6 classes as the second argument of <code>document.register</code> method.</p>
</div>

<div class="informative">
<p>The element upgrade and invoking lifecycle callbacks is intentionally decoupled to provide slightly more sensible outcomes of callbacks trying to access methods and properties of custom elements of the same kind. Also, because of when lifecycle callbacks are added to the lifecycle callbacks queue, the queue should be empty when <code>document.register</code> is invoked.</p>
</div>

<div class="informative">
<p>In order to <a href="#dfn-element-registration">register</a> a <a href="#dfn-custom-element">custom element</a> with a prototype, other than <code>HTMLElement</code> or <code>SVGElement</code>, the caller of <code>document.register</code> has to first build a proper prototype object that inherits from <code>HTMLElement</code>. Here's a simple example of how one could do this:</p>
<pre><code class="prettyprint">
document.register('x-foo', {
    prototype: Object.create(HTMLParagraphElement.prototype, {
        firstMember: {
            get: function() { return "foo"; },
            enumerable: true,
            configurable: true
        },
        // specify more members for your prototype.
        // ...
    })
});

</code></pre>
</div>

<h3 id="unresolved-element-pseudoclass">Unresolved Element Pseudoclass</h3>

<p>The <code>:unresolved</code> <a href="http://www.w3.org/TR/CSS2/selector.html#pseudo-elements">pseudoclass</a> <strong>must</strong> match all <a href="#dfn-custom-element">custom elements</a> whose <a href="#dfn-created-callback">created</a> callback has yet not been invoked.</p>

<div class="informative">
<p>The <code>:unresolved</code> <a href="http://www.w3.org/TR/CSS2/selector.html#pseudo-elements">pseudoclass</a> could be used to mitigate the <a href="http://en.wikipedia.org/wiki/Flash_of_unstyled_content">Flash of Unstyled Content</a> (FOUC) issues with <a href="#dfn-custom-element">custom elements</a>.
</div>

<h2 id="instantiating-custom-elements">Instantiating Custom Elements</h2>

<p>The <a href="#dfn-custom-element-type">custom element type</a> is given to a <a href="#dfn-custom-element">custom element</a> at the time of its instantation in one of the two ways:</p>
<ol>
    <li>As the <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> of the <a href="#dfn-custom-element">custom element</a>. These types of <a href="#dfn-custom-element-type">custom element types</a> are called <dfn id="dfn-custom-tag">custom tags</dfn>.</li>
    <li>As the value of the <code>is</code> <a href="http://dom.spec.whatwg.org/#concept-named-attribute">attribute</a> of the <a href="#dfn-custom-element">custom element</a>. <a href="#dfn-custom-element-type">custom element types</a> given this way are called <dfn id="dfn-type-extension">type extensions</dfn>.</li>
</ol>

<p>After a <a href="#dfn-custom-element">custom element</a> is instantiated, changing the value of the <code>is</code> <a href="http://dom.spec.whatwg.org/#concept-named-attribute">attribute</a> <strong>must not</strong> affect this element's <a href="#dfn-custom-element-type">custom element type</a>.</p>

<p>If both types of <a href="#dfn-custom-element-type">custom element types</a> are provided at the time of element's instantiation, the <a href="#dfn-custom-tag">custom tag</a> <strong>must</strong> win over the <a href="#dfn-type-extension">type extension</a>.

<p>All <a href="#dfn-custom-element">custom elements</a> <strong>must</strong> be constructable with a <a href="http://www.w3.org/TR/WebIDL/#dfn-function-object">function object</a>, called <dfn id="dfn-custom-element-constructor">custom element constructor</dfn>. This constructor <strong>must</strong> be created with the <dfn id="dfn-custom-element-constructor-generation">custom element constructor generation algorithm</dfn>, which <strong>must</strong> be <a href="#dfn-processing-equivalence">equivalent</a> to running these steps:</p>
<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>PROTOTYPE</var>, the <a href="#dfn-custom-element-prototype">custom element prototype</a>.</dd>
    <dd><var>DOCUMENT</var>, the owner <a href="http://www.w3.org/TR/domcore/#concept-document">document</a> for new <a href="#dfn-custom-element">custom element</a></dd>
<dt>Output</dt>
    <dd><var>CONSTRUCTOR</var>, the <a href="#dfn-custom-element-constructor">custom element constructor</a></dd>
</dl>
<ol>
    <li>If <var>PROTOTYPE</var> is already an <a href="http://www.w3.org/TR/WebIDL/#dfn-interface-prototype-object">interface prototype object</a> for any <a href="http://www.w3.org/TR/WebIDL/#dfn-interface-object">interface object</a> <strong>or</strong> <var>PROTOTYPE</var> has a <a href="http://es5.github.io/#x8.6.1">non-configurable</a> property named <code>constructor</code>, throw a <a href="http://dom.spec.whatwg.org/#notsupportederror"><code>NotSupportedError</code></a> and <strong>stop</strong>.</li>
    <li>Let <var>DEFINITION</var> be an <a href="#dfn-element-definition">element definition</a> that has <var>PROTOTYPE</var> as <a href="#dfn-custom-element-prototype">custom element prototype</a></li>
    <li>Let <var>CONTEXT</var> be the <a href="#dfn-registration-context">registration context</a> of <var>DOCUMENT</var></li>
    <li>Let <var>CONSTRUCTOR</var> be the <a href="http://www.w3.org/TR/WebIDL/#dfn-interface-object">interface object</a> whose <a href="http://www.w3.org/TR/WebIDL/#dfn-interface-prototype-object">interface prototype object</a> is <var>PROTOTYPE</var> and when called as a constructor, executes these steps:
    <ol>
        <li>If the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#window"><code>Window</code></a> object of the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/webappapis.html#script's-browsing-context">script's browsing context</a> is not <var>CONTEXT</var>, <a href="http://dom.spec.whatwg.org/#concept-throw">throw</a> an <a href="http://dom.spec.whatwg.org/#invalidstateerror"><code>InvalidStateError</code></a> and <strong>stop</strong>.</li>
        <li>Let <var>ELEMENT</var> be the <a href="http://dom.spec.whatwg.org/#context-object">context object</a></li>
        <li>Let <var>TYPE</var> be the <a href="#dfn-custom-element-type">custom element type</a> in <var>DEFINITION</var></li>
        <li>Let <var>NAME</var> be the <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> in <var>DEFINITION</var></li>
        <li>Let <var>NAMESPACE</var> be the <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a> in <var>DEFINITION</var></li>
        <li>Set <var>ELEMENT</var>'s <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> to <var>NAME</var>, <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a> to the <var>NAMESPACE</var>, and <a href="http://dom.spec.whatwg.org/#concept-node-document">node document</a> to <var>DOCUMENT</var></li>
        <li>If <var>TYPE</var> is not the same as <var>NAME</var>, set the value of <var>ELEMENT</var>'s <code>is</code> <a href="http://dom.spec.whatwg.org/#concept-named-attribute">attribute</a> to <var>TYPE</var></li>
        <li>Run the <a href="#dfn-element-initialization">element initialization algorithm</a> with <var>ELEMENT</var> as argument</li>
        <li>Return <var>ELEMENT</var>.</li>
    </ol></li>
</ol>
</div>

<div class="monkeypatch" id="monkeypatch-create-element">

<p>To allow creating both <a href="#dfn-custom-tag">custom tag</a> and <a href="#dfn-type-extension">type extension</a>-style <a href="#dfn-custom-element">custom elements</a>, the <a href="http://dom.spec.whatwg.org/#dom-document-createelement"><code>createElement</code></a> or <a href="http://dom.spec.whatwg.org/#dom-document-createelementns"><codE>createElementNS</code></a> methods have an optional <code>typeExtension</code> argument:</p>

<pre><code>
partial interface <a href="http://www.w3.org/TR/domcore/#document">Document</a> {
    <a href="http://dom.spec.whatwg.org/#element">Element</a> createElement(DOMString localName, optional DOMString typeExtension);
    <a href="http://dom.spec.whatwg.org/#element">Element</a> createElementNS(DOMString? namespace, DOMString qualifiedName, optional DOMString typeExtension);
};
</code></pre>

<p>Instead of step 3 in <a href="http://dom.spec.whatwg.org/#dom-document-createelement"><code>createElement</code></a> and step 9 in <a href="http://dom.spec.whatwg.org/#dom-document-createelementns"><codE>createElementNS</code></a> (the steps that determine <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a>, both methods <strong>must</strong> run the following 
steps:</p>
<ol>
    <li>Let <var>TYPE</var> be <em>typeExtension</em>, or <em>localName</em> if <em>typeExtension</em> is not present</li>
    <li>If an <a href="#dfn-element-definition">element definition</a> with matching <em>localName</em>, <em>namespace</em>, and <var>TYPE</var> is <strong>not</strong> <a href="#dfn-element-registration">registered</a> with <em>token</em>'s document, set <var>TYPE</var> to <em>localName</em></li>
    <li>Let <em>interface</em> be the <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> for <var>TYPE</var> as <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> and <em>namespace</em> (<a href="http://www.w3.org/1999/xhtml">HTML Namespace</a> for <a href="http://dom.spec.whatwg.org/#dom-document-createelement"><code>createElement</code></a>)</li>
</ol>

<p>Additionally, both <a href="http://dom.spec.whatwg.org/#dom-document-createelement"><code>createElement</code></a> or <a href="http://dom.spec.whatwg.org/#dom-document-createelementns"><codE>createElementNS</code></a> methods <strong>must</strong> run the following steps just <em>before</em> returning the result:</p>
<ol>
    <li>If <var>TYPE</var> is not the same as <em>localName</em>, set the value of <var>ELEMENT</var>'s <code>is</code> <a href="http://dom.spec.whatwg.org/#concept-named-attribute">attribute</a> to <var>TYPE</var></li>
    <li>Run <a href="#dfn-element-initialization">element initialization algorithm</a> with the newly created <a href="http://dom.spec.whatwg.org/#concept-element">element</a></li>
</ol>
</div>

<p>The <dfn id="dfn-element-initialization">element initialization algorithm</dfn> <strong>must</strong> be <a href="#dfn-processing-equivalence">equivalent</a> to running these steps:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>ELEMENT</var>, an <a href="http://www.w3.org/TR/domcore/#concept-element">element</a> being initialized</dd>
<dt>Output</dt>
    <dd>None</dd>
</dl>
<ol>
    <li>Let <var>DEFINITION</var> be <var>ELEMENT</var>'s <a href="#dfn-element-definition">definition</a></li>
    <li>Let <var>CREATED</var> be the result of <a href="#dfn-retrieve-callback">retrieving a callback</a> named <em>created</em></li>
    <li>If it is not <code>null</code>, invoke <var>CREATED</var> callback with <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback this value</a> of <var>ELEMENT</var></li>
</ol>
</div>

<h2 id="serializing-and-parsing">Serializing and Parsing Custom Elements in HTML</h2>

<p>To enable instantiating <a href="#dfn-custom-element">custom elements</a> during <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#tree-construction">tree construction</a>, a conforming UA <strong>must</strong> run these steps when <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#create-an-element-for-the-token">creating an element for a token</a>:</p>

<div class="monkeypatch">
<dl>
<dt>Input</dt>
    <dd><var>DOCUMENT</var>, the <a href="http://www.w3.org/TR/domcore/#concept-document">document</a> in which the element is being created</dd>
    <dd><var>TOKEN</var>, token tag name</dd>
    <dd><var>NAMESPACE</var>, token <a href="http://dom.spec.whatwg.org/#concept-element-namespace">namespace</a></dd>
<dt>Output</dt>
    <dd><var>ELEMENT</var>, an element</dd>
</dl>
<ol>
    <li>Let <var>NAME</var> be the tag name of the <em>token</em></li>
    <li>Let <var>NAMESPACE</var> be the <em>token</em>'s namespace</li>
    <li>Let <var>TYPE</var> be the value of <code>is</code> attribute for the <em>token</em> or <var>NAME</var>, if this attribute is not present</li>
    <li>If <var>DOCUMENT</var> is an <a href="http://dom.spec.whatwg.org/#html-document">HTML document</a>, <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#converted-to-ascii-lowercase">convert</a> both <var>NAME</var> and <var>TYPE</var> to lowercase</li>
    <li>If an <a href="#dfn-element-definition">element definition</a> with matching <var>NAME</var>, <var>NAMESPACE</var>, and <var>TYPE</var> is <strong>not</strong> <a href="#dfn-element-registration">registered</a> with <em>token</em>'s document, set <var>TYPE</var> to <var>NAME</var></li>
    <li>Let <var>ELEMENT</var> be the result of creating a node implementing the interface appropriate for the element type corresponding to <var>TYPE</var> and <var>NAMESPACE</var></li>
    <li>Let <var>CREATED</var> be the result of <a href="#dfn-retrieve-callback">retrieving a callback</a> named <em>created</em>.</li>
    <li>Place <var>CREATED</var> and <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback this value</a> of <var>ELEMENT</var> at the front of the <a href="#dfn-lifecycle-callbacks-queue">lifecycle callbacks queue</a>.</li>
</ol>
</div>

<div class="informative">
<p>This modification to <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#create-an-element-for-the-token">creating an element for a token</a> has the consequence of <a href="#dfn-custom-element">custom elements</a> being created when <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html#parsing">parsing HTML documents</a> or <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-end.html#html-fragment-parsing-algorithm">fragments</a>.</p>
</div>

<p>In addition, as part of the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/webappapis.html#perform-a-microtask-checkpoint">microtask checkpoint</a>, the user agent <strong>must</strong> <a href="#dfn-invoke-lifecycle-callbacks">invoke lifecycle callbacks</a> for the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a> to which the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/webappapis.html#script's-browsing-context">scripts' browsing context</a> belongs.</p>

<div class="informative">
Currently, the HTML spec has sequential processing of steps in <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/webappapis.html#perform-a-microtask-checkpoint">microtask checkpoint</a>. Since every step may potentially generate additional microtasks for past steps, this may lead to incomplete fulfillment of microtask checkpoint objectives. This specification assumes that this deficiency has been addressed and adding a new step to microtask checkpoint guarantees exhaustion of microtasks for all types of steps.
</div>

<p>The <a href="#dfn-custom-element">custom elements</a> <strong>must</strong> be serialized like <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-end.html#serializing-html-fragments">any HTML elements</a>.</p>

<h2 id="declaring-custom-elements">Declaring Custom Elements</h2>

<div class="warning">This section needs more work, specifically resolution of <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=22833">bug 22833</a>.</div>

<p><a href="#dfn-custom-element">Custom elements</a> can also be <a href="#dfn-element-registration">registered</a> using <a href="#dfn-custom-element-declaration">custom element declarations</a>. A <dfn id="dfn-custom-element-declaration">custom element declaration</dfn> consists of:</p>
<ul>
    <li><a href="#dfn-custom-element-type">custom element type</a> for the new <a href="#dfn-custom-element">custom element</a></li>
    <li>Optional <dfn id="dfn-base-element-name">base element name</dfn>, which is either:
    <ol>
        <li>A <a href="#dfn-custom-element-type">custom element type</a>, or</li>
        <li>A <a href="http://dom.spec.whatwg.org/#concept-element-local-name">local name</a> of an <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#html-elements">HTML element</a></li>
    </ol></li>
    <li>Optional <dfn id="dfn-constructor-name">constructor name</dfn>, a valid <a href="http://ecma-international.org/ecma-262/5.1/#sec-7.6">IdentifierName</a></li>
    <li>Optional  <dfn id="dfn-declaration-property-bag">declaration property bag</dfn>, a <a href="http://www.w3.org/TR/WebIDL/#idl-dictionaries">dictionary</a>.</li>
</ul>

<p>The <a href="#dfn-base-element-name">base element name</a> and <a href="#dfn-declaration-property-bag">declaration property bag</a> are used to create the <a href="#dfn-custom-element-prototype">custom element prototype</a> of a new <a href="#dfn-custom-element">custom element</a>. To <dfn id="dfn-create-custom-element-prototype">create custom element prototype</dfn>, the user agent <strong>must</strong> run the following steps or their <a href="#dfn-processing-equivalence">equivalent</a>:</p>
<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>BASE</var>, the <a href="#dfn-base-element-name">base element name</a></dd>
    <dd><var>PROPERTIES</var>, the <a href="#dfn-declaration-property-bag">declaration property bag</a></dd>
<dt>Output</dt>
    <dd><var>PROTOTYPE</var>, the <a href="#dfn-custom-element-prototype">custom element prototype</a>, or <strong>nothing</strong></dd>
</dl>
<ol>
    <li>If <var>BASE</var> is <strong>null</strong>, let <var>INTERFACE</var> be <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#htmlelement"><code>HTMLElement</code></a></li>
    <li>Otherwise, let <var>INTERFACE</var> be the <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> for <var>BASE</var> and <a href="http://www.w3.org/1999/xhtml">HTML Namespace</a></li>
    <li>If such <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> does not exist, <strong>stop</strong>, returning <strong>nothing</strong>.</li>
    <li>Let <var>DESCRIPTORS</var> be an empty <a href="http://es5.github.io/#x8.6"><code>Object</code></a></li>
    <li>If <var>PROPERTIES</var> is not <strong>null</strong> and is an <a href="http://es5.github.io/#x8.6"><code>Object</code></a>:
    <ol>
        <li>Let <var>KEYS</var> be the result of invoking <a href="http://es5.github.io/#x15.2.3.4"><code>Object.getOwnPropertyNames</code></a> with <var>PROPERTIES</var> as argument</li>
        <li>For each item <var>KEY</var> in <var>KEYS</var>
        <ol>
            <li>Let <var>DESCRIPTOR</var> be the result of invoking <a href="http://es5.github.io/#x15.2.3.3"><code>Object.getPropertyDescriptor</code></a> with <var>PROPERTIES</var> and <var>KEY</var> as arguments</li>
            <li>Call <a href="http://es5.github.io/#x8.12.5"><code>[[Put]]</code></a> <a href="http://es5.github.io/#x8.6.2">internal method</a> of <var>DESCRIPTORS</var> with <var>KEY</var>, <var>DESCRIPTOR</var> and <strong>false</strong> as arguments</li>
        </ol></li>
    </ol></li>
    <li>Let <var>PROTOTYPE</var> be the result of invoking <a href="http://es5.github.com/#x15.2.3.5"><code>Object.create</code></a> with <var>INTERFACE</var> and <var>DESCRIPTORS</var> as arguments</li>
</ol>
</div>

<p>To <dfn id="dfn-register-custom-element-from-declaration">register custom element from declaration</dfn>, a user agent <strong>must</strong> run the following steps or their <a href="#dfn-processing-equivalence">equivalent</a>:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>DECLARATION</var>, a <a href="#dfn-custom-element-declaration">custom element declaration</a></dd>
    <dd><var>DOCUMENT</var>, a <a href="http://dom.spec.whatwg.org/#concept-document">document</a></dd>
<dt>Output</dt>
    <dd>None</dd>
</dl>
<ol>
    <li>Let <var>TYPE</var> be the <a href="#dfn-custom-element-type">custom element type</a> in <var>DECLARATION</var></li>
    <li>Let <var>PROPERTIES</var> be the <a href="#dfn-declaration-property-bag">declaration property bag</a> in <var>DECLARATION</var></li>
    <li>Let <var>BASE</var> be the <a href="#dfn-base-element-name">base element name</a> in <var>DECLARATION</var></li>
    <li>Let <var>PROTOTYPE</var> be the result of <a href="#dfn-create-custom-element-prototype">creating custom element prototype</a> with <var>BASE</var> and <var>PROPERTIES</var> as arguments</li>
    <li>If <var>PROTOTYPE</var> is <strong>nothing</strong>, <strong>stop</strong>.</li>
    <li>Run <a href="#dfn-element-registration-algorithm">element registration algorithm</a> with <var>DOCUMENT</var>, <var>TYPE</var>, <var>PROTOTYPE</var>, and <var>BASE</var> as arguments</li>
    <li>Let <var>KEY</var> be the <a href="#dfn-constructor-name">constructor name</a> in <var>DECLARATION</var></li>
    <li>Let <var>CONSTRUCTOR</var> be the result of running <a href="#dfn-custom-element-constructor-generation">custom element constructor generation algorithm</a> with <var>DOCUMENT</var> and <var>PROTOTYPE</var> as arguments</li>
    <li>Let <var>DESCRIPTOR</var> be a <a href="http://es5.github.io/#x8.10">property descriptor</a> <code>{[[Value]]:</code><var>CONSTRUCTOR</var><code>, [[Writable]]: true, [[Enumerable]]: false, [[Configurable]]: true}</code></li>
    <li>Call <a href="http://es5.github.io/#x8.12.9"><code>[[DefineOwnProperty]]</code></a> <a href="http://es5.github.io/#x8.6.2">internal method</a> of the <a href="http://es5.github.io/#x15.1">global object</a> with <var>KEY</var>, <var>CONSTRUCTOR</var>, and <strong>false</strong> as arguments</li>
</ol>
</div>

<p>Each <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a> has an associated <dfn id="dfn-declaration-processing-queue">declaration processing queue</dfn>, which is initially empty. Each item in the queue consists of a <a href="#dfn-custom-element-declaration">custom element declaration</a> and a <a href="http://dom.spec.whatwg.org/#concept-document">document</a>.</p>

<p>Also, each <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin contexts</a> has a <dfn id="dfn-processing-declarations">processing declarations</dfn> flag, which <strong>must</strong> initially be <strong>false</strong>. It is used to prevent reentrant invocation of the <a href="#dfn-declaration-processing-algorithm">declaration processing algorithm</a>.</p>

<p>The <dfn id="dfn-declaration-processing-algorithm">declaration processing algorithm</dfn> <strong>must</strong> be <a href="#dfn-processing-equivalence">equivalent</a> to running the following steps:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>ENVIRONMENT</var>, the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a></dd>
<dt>Output</dt>
    <dd>None</dd>
</dl>
<ol>
    <li>Let <var>PROCESSING</var> be the <a href="#dfn-processing-declarations">processing declarations</a> flag</li>
    <li>If <var>PROCESSING</var> is <strong>true</strong>, <strong>stop</strong>.</li>
    <li>Set <var>PROCESSING</var> to <strong>true</strong></li>
    <li>Let <var>QUEUE</var> be a copy of the <var>ENVIRONMENT</var>'s <a href="#dfn-declaration-processing-queue">declaration processing queue</a></li>
    <li>While <var>QUEUE</var> is not empty:
    <ol>
        <li>Empty <var>QUEUE</var>'s <a href="#dfn-declaration-processing-queue">declaration processing queue</a></li>
        <li>For each <var>ITEM</var> in <var>QUEUE</var>:
        <ol>
            <li>Let <var>DOCUMENT</var> be the <a href="http://dom.spec.whatwg.org/#concept-document">document</a> in <var>ITEM</var></li>
            <li>Let <var>DECLARATION</var> be the <a href="#dfn-custom-element-declaration">custom element declaration</a> in <var>ITEM</var></li>
            <li><a href="#dfn-register-custom-element-from-declaration">Register custom element from declaration</a> using <var>DECLARATION</var> and <var>DOCUMENT</var> as arguments</li>
        </ol></li>
        <li>Let <var>QUEUE</var> be a copy of the <var>ENVIRONMENT</var>'s <a href="#dfn-declaration-processing-queue">declaration processing queue</a></li>
    </ol></li>
    <li>Set <var>PROCESSING</var> to <strong>false</strong>.</li>
</ol>
</div>

<p><a href="http://dom.spec.whatwg.org/#concept-document">Documents</a> have a <a href="http://en.wikipedia.org/wiki/Strong_reference">strong reference</a> to respective items in <a href="#dfn-declaration-processing-queue">declaration processing queue</a>, and items in the <a href="#dfn-declaration-processing-queue">declaration processing queue</a> have a <a href="http://en.wikipedia.org/wiki/Weak_reference">weak reference</a> to their <a href="http://dom.spec.whatwg.org/#concept-document">document</a>.</p>

<p>As part of the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/webappapis.html#perform-a-microtask-checkpoint">microtask checkpoint</a>, the user agent <strong>must</strong> run <a href="http://parkour.mtv/webcomponents/spec/custom/index.html#dfn-declaration-processing-algorithm">declaration processing algorithm</a> for the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/browsers.html#unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</a> to which the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/webappapis.html#script's-browsing-context">scripts' browsing context</a> belongs.</p>

<h3 id="the-element-element">The <code>element</code> HTML element</h3>

<p>The <a href="#the-element-element"><code>element</code></a> <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#html-elements">HTML element</a> represents a <a href="#dfn-custom-element-declaration">custom element declaration</a>.</p>

<dl>
<dt>Context</dt>
<dd>Where <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#flow-content-0">flow content</a> is expected.</dd>
<dt>Content model</dt>
<dd><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#metadata-content">Metadata content</a></dd>
<dt>Children</dt>
<dd><!-- One <code>template</code> element and z-->Zero or more <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/scripting-1.html#the-script-element"><code>script</code></a> elements</dd>
<dt>Content attributes</dt>
<dd><a href="http://dev.w3.org/html5/spec/Overview.html#global-attributes">Global attributes</a></dd>
<dd><a href="#markup-element-constructor"><code>constructor</code></a></dd>
<dd><a href="#markup-element-extends"><code>extends</code></a></dd>
<dd><a href="#markup-element-name"><code>name</code></a></dd>
<dt>DOM Interface</dt>
<dd>
    <pre><code class="prettyprint">
interface <dfn id="api-html-element-element" class="no-backreference">HTMLElementElement</dfn> : <a href="http://dev.w3.org/html5/spec/Overview.html#htmlelement">HTMLElement</a> {
    attribute DOMString? <a href="#dfn-html-element-element-constructor-name">constructorName</a>;
    attribute DOMString? <a href="#dfn-html-element-element-extends">extends</a>;
    attribute DOMString? <a href="#dfn-html-element-element-name">name</a>;
};</code></pre>
</dd>
</dl>

<p>The <dfn id="markup-element-constructor"><code>constructor</code></dfn> attribute represents <a href="#dfn-constructor-name">constructor name</a> in <a href="#dfn-custom-element-declaration">custom element declaration</a>. The value of the attribute is expected to be a valid <a href="http://ecma-international.org/ecma-262/5.1/#sec-7.6">IdentifierName</a>.</p>

<p>The <dfn id="markup-element-extends"><code>extends</code></dfn> attribute represents <a href="#dfn-base-element-name">base element name</a> in <a href="#dfn-custom-element-declaration">custom element declaration</a>.</p>

<p>The <dfn id="markup-element-name"><code>name</code></dfn> attribute represents <a href="#dfn-custom-element-type">custom element type</a> in <a href="#dfn-custom-element-declaration">custom element declaration</a>.</p>

<p>The <dfn id="dfn-html-element-element-constructor-name"><code>constructorName</code></dfn> <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html">IDL attribute</a> <strong>must</strong> <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/common-dom-interfaces.html#reflect">reflect</a> the <a href="#markup-element-constructor">constructor</a> content attribute.</p>

<p>The <dfn id="dfn-html-element-element-extends"><code>extends</code></dfn> and <dfn id="dfn-html-element-element-name"><code>name</code></dfn> <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html">IDL attributes</a> <strong>must</strong> <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/common-dom-interfaces.html#reflect">reflect</a> the respective content attributes of the same name.</p>

<div class="informative">
Changing <a href="#markup-element-name"><code>name</code></a>, <a href="#markup-element-constructor"><code>constructor</code></a>, or <a href="#markup-element-extends"><code>extends</code></a> attributes dynamically has no direct effect; these attributes are only used at specific times, described below.
</div>

<div class="informative">This <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#html-elements">HTML element</a> does not <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#represents">represent</a> content to the user.</div>

<p>Every <a href="#the-element-element"><code>element</code></a> element has a <dfn id="dfn-parser-inserted">parser-inserted</dfn> flag, which indicates whether the element was inserted by the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html#html-parser">HTML parser</a> or the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-xhtml-syntax.html#xml-parser">XML Parser</a>.</p>

<p>Additionally, every <a href="http://dom.spec.whatwg.org/#concept-document">document</a> has a <dfn id="dfn-last-completion-value">last completion value</dfn>, associated with it. The user agent <strong>must</strong> store the <a href="http://es5.github.io/#x8.9">completion value</a> of type <strong>normal</strong> for any <a href="http://www.whatwg.org/specs/web-apps/current-work/#execute-the-script-block">script block execution</a> as <a href="#dfn-last-completion-value">last completion value</a> <em>and</em> clear <a href="#dfn-last-completion-value">last completion value</a> prior to executing another <a href="http://www.whatwg.org/specs/web-apps/current-work/#execute-the-script-block">script block</a>.</p>

<p>To <dfn id="dfn-create-custom-element-declaration">create custom element declaration</dfn> from an <a href="#the-element-element"><code>element</code></a> element, the user agent <strong>must</strong> run the following steps or their <a href="#dfn-processing-equivalence">equivalent</a>:</p>

<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>ELEMENT</var>, the <a href="#the-element-element"><code>element</code></a> element</dd>
<dt>Output</dd>
    <dd><var>DECLARATION</var>, the <a href="#dfn-custom-element-declaration">custom element declaration</a> or <strong>nothing</strong></dd>
</dl>
<ol>
    <li>Let <var>TYPE</var> be the value of <var>ELEMENT</var>'s <a href="#markup-element-name"><code>name</code></a> attribute, <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#converted-to-ascii-lowercase">converted</a> to lowercase</li>
    <li>If <var>TYPE</var> is empty or is an invalid <a href="#dfn-custom-element-type">custom element type</a>, <strong>stop</strong>.</li>
    <li>Let <var>BASE</var> be the value of <var>ELEMENT</var>'s <a href="#markup-element-extends"><code>extends</code></a> attribute, <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#converted-to-ascii-lowercase">converted</a> to lowercase</li>
    <li>If <var>BASE</var> is empty, let <var>INTERFACE</var> be <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#htmlelement"><code>HTMLElement</code></a></li>
    <li>Otherwise, let <var>INTERFACE</var> be the <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> for <var>BASE</var> and <a href="http://www.w3.org/1999/xhtml">HTML Namespace</a></li>
    <li>If such <a href="http://dom.spec.whatwg.org/#concept-element-interface">element interface</a> does not exist, <strong>stop</strong>.</li>
    <li>Let <var>CONSTRUCTOR</var> be the value of <var>ELEMENT</var>'s <a href="#markup-element-constructor"><code>constructor</code></a> attribute</li>
    <li>Let <var>DOCUMENT</var> be <var>ELEMENT</var>'s <a href="http://dom.spec.whatwg.org/#concept-document">document</a></li>
    <li>Let <var>PROPERTIES</var> be <var>DOCUMENT</var>'s <a href="#dfn-last-completion-value">last completion value</a></li>
    <li>Let <var>DECLARATION</var> be a <a href="#dfn-custom-element-declaration">custom element declaration</a> with <a href="#dfn-custom-element-type">custom element type</a> set to <var>TYPE</var>, <a href="#dfn-base-element-name">base element name</a> to <var>BASE</var>, <a href="#dfn-constructor-name">constructor name</a> to <var>CONSTRUCTOR</var>, and <a href="#dfn-declaration-property-bag">declaration property bag</a> to <var>PROPERTIES</var></li>
</ol>
</div>

<p class="fixme" id="bug-22833"><a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=22833">Bug 22833</a>: This algorithm does not account for out-of-order declarations. Suppose that the BASE is also a custom element, and its declaration hasn't been loaded yet. This will turn this declaration into a dud.</p>

<p>When an <a href="#the-element-element"><code>element</code></a> element gets <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#insert-an-element-into-a-document">inserted into a document</a> <em>and</em> if the <a href="#dfn-parser-inserted">parser-inserted</a> flag is not set on this element, the user agent <strong>must</strong> synchronously run the following steps at the time <a href="http://dom.spec.whatwg.org/#node-is-inserted">node is inserted</a>, immediately after all <a href="http://dom.spec.whatwg.org/#concept-tree-descendant">descendant</a> <a href="http://dom.spec.whatwg.org/#concept-node">nodes</a> are <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/infrastructure.html#insert-an-element-into-a-document">inserted into document</a>:</p>
<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>ELEMENT</var>, the <a href="#the-element-element"><code>element</code></a> element</dd>
<dt>Output</dd>
    <dd>None.</dd>
</dl>
<ol>
    <li>Let <var>DECLARATION</var> be the result of <a href="#dfn-create-custom-element-declaration">creating custom element declaration</a> with <var>ELEMENT</var> as argument</li>
    <li>If <var>DECLARATION</var> is <strong>nothing</strong>, <strong>stop</strong>.</li>
    <li><a href="#dfn-register-custom-element-from-declaration">Register custom element from declaration</a> using <var>DECLARATION</var> and <var>ELEMENT</var>'s <a href="http://dom.spec.whatwg.org/#concept-document">document</a> as arguments</li>
</ol>
</div>

<div class="fixme" id="bug-22126"><a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=22126">Bug 22126</a>: As designed now, declarations only provide a way to build elements in HTML namespace. Is this enough?</div>

<p>The user agent <strong>may</strong> report any errors encountered while <a href="#dfn-declaration-processing-algorithm">processing a declaration</a> to the user (e.g. in a debugging console).</p>

<p>When the <a href="http://www.whatwg.org/specs/web-apps/current-work/#html-parser">HTML Parser</a> or the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-xhtml-syntax.html#xml-parser">XML Parser</a> creates an <a href="#the-element-element"><code>element</code></a> element, the user agent <strong>must</strong> do the following:</p>
<ul>
    <li>Clear the <a href="#dfn-last-completion-value">last completion value</a></li>
    <li>Set the element's <a href="#dfn-parser-inserted">parser-inserted</a> flag</li>
</ul>

<p>When the <a href="#the-element-element"><code>element</code></a> element's end tag is parsed, the user agent <strong>must</strong> run the following steps:</p>
<div class="algorithm">
<dl>
<dt>Input</dt>
    <dd><var>ELEMENT</var>, the <a href="#the-element-element"><code>element</code></a> being processed</dd>
<dt>Output</dt>
    <dd>None</dd>
</dl>
<ol>
    <li>Let <var>DECLARATION</var> be the result of <a href="#dfn-create-custom-element-declaration">creating custom element declaration</a> with <var>ELEMENT</var> as argument</li>
    <li>If <var>DECLARATION</var> is not <strong>nothing</strong>, add <var>DECLARATION</var> and <var>ELEMENT</var>'s <a href="http://dom.spec.whatwg.org/#concept-document">document</a> to <a href="#dfn-declaration-processing-queue">declaration processing queue</a></li>
</ol>
</div>

<!--

<div class="informative">The term "JavaScript" is used to refer to ECMA262, rather than the official term ECMAScript, since the term JavaScript is more widely known.</div>

<h2 id="other-languages">Supporting Other Languages</h2>

<p><span class="fixme">Explain how inheritance in custom elements can be extended to other languages.</span></p>

-->
</section>

<h2 id="acknowledgements">Acknowledgements</h2>

<p><span class="vcard">David Hyatt</span> developed <a href="http://dev.w3.org/2006/xbl2/">XBL 1.0</a>, and <span class="vcard">Ian Hickson</span> co-wrote <a href="http://dev.w3.org/2006/xbl2/">XBL 2.0</a>. These documents provided tremendous insight into the problem of behavior attachment and greatly influenced this specification.</p>

<p><span class="vcard">Alex Russell</span> and his considerable forethought triggered a new wave of enthusiasm around the subject of behavior attachment and how it can be applied practically on the Web.</p>

<p><span class="vcard">Dominic Cooney</span>, <span class="vcard">Hajime Morrita</span>, and <span class="vcard">Roland Steiner</span> worked tirelessly to scope the problem within the confines of the Web platform and provided a solid foundation for this document.</p>

<p>The editor would also like to thank <span class="vcard">Alex Komoroske</span>, <span class="vcard">Anne van Kesteren</span>, <span class="vcard">Boris Zbarsky</span>, <span class="vcard">Daniel Buchner</span>, <span class="vcard">Edward O'Connor</span>, <span class="vcard">Erik Arvidsson</span>, <span class="vcard">Elliott Sprehn</span>, <span class="vcard">Hayato Ito</span>, <span class="vcard">Jonas Sicking</span>, <span class="vcard">Olli Pettay</span>, <span class="vcard">Rafael Weinstein</span>, <span class="vcard">Scott Miles</span>, <span class="vcard">Steve Orvell</span>, <span class="vcard">Tab Atkins</span>, and <span class="vcard">William Chen</span> for their comments and contributions to this specification.</p>

<p>This list is too short. There's a lot of work left to do. Please contribute by reviewing and filing bugs&mdash;and don't forget to ask the editor to add your name into this section.</p>

</body>
</html>
